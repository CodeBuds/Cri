#!/bin/sh -e

echo ""
echo ""
echo ""
echo ""
echo ""
echo ""
echo "PLEASE READ ALL OF THIS AND ANSWER CAREFULLY... If you don't you might need to reinstall this script"
echo "The problem here is that we can't just randomly change deep system files"
echo "we will need to remount the user filesystem so we can edit the bin settings"
echo ""
echo "If you select something besides no, program will exit..."
echo "If you select yes or put some other character, (if not already) continue installation using the second"
echo "Half of the script which is located on github"
sleep 5
ask() {
    # http://djm.me/ask
    while true; do

        if [ "${2:-}" = "Y" ]; then
            prompt="Y/n"
            default=Y
        elif [ "${2:-}" = "N" ]; then
            prompt="y/N"
            default=N
        else
            prompt="y/n"
            default=
        fi

        # Ask the question - use /dev/tty in case stdin is redirected from somewhere else
        read -n -p "$1 [$prompt] " REPLY </dev/tty

        # Default?
        if [ -z "$REPLY" ]; then
            REPLY=$default
        fi

        # Check if the reply is valid
        case "$REPLY" in
            Y*|y*) return 0 ;;
            N*|n*) return 1 ;;
        esac

    done
}
echo ""
if ask "Have you mounted and rebooted your syetem to read and write yet?"; then
    exit
else
    echo ""
fi
set +e
  echo "Please be ready to anwser system settings questions, so that we can proceed"
  sleep 3
  set +e
  sudo /usr/share/vboot/bin/make_dev_ssd.sh --remove_rootfs_verification
  set +e
  sudo crossystem dev_boot_signed_only=0
  sleep 1
  echo ""
  echo ""
  echo "I just ran a script to modify your kernel, so I can access system directories..."
  echo "The above command I just ran said 'Try running the script with ...... --partitions N'"
  echo ""
  echo ""
  
  read -n 1 -p "Please enter (The number nothing else (ex: 2)) the number of the partition N above: " AN </dev/tty
  sudo /usr/share/vboot/bin/make_dev_ssd.sh --remove_rootfs_verification --partitions $an
  sudo crossystem dev_boot_signed_only=0
  sudo mount -o remount,rw /
  echo "Succesful remount of system, now the rest of the script should run with little warnings besides"
  echo "BUT"
  echo "To get it working make sure you run the second part which should be on the github page"
  echo ""
  sleep 5
  echo ""
  read -n 1 -p "You need to reboot, do you want to now?(It is highly reccomended) [y/n]" NY </dev/tty
  sleep 1
  case $NY in
  [yY]* ) sudo reboot;;
  [nN]* ) exit;;
  * ) echo "Sorry didn't understand '$AN' and/or '$NY' :'(";; 
  esac
  exit
